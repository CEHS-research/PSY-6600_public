---
title: "Psy/Educ 6600: Unit 5 Homework"
subtitle: "Chapter 16: Mixed Design ANOVA"
author: "Your Name"
date: "Spring 2018"
output: 
  pdf_document:
    keep_tex: yes
    latex_engine: xelatex
    toc: true
    toc_depth: 3
    number_sections: false
---

\clearpage

# PREPARATION

```{r oppts, include=FALSE}
# set global chunk options...  
#  this changes the defaults so you don't have to repeat yourself
knitr::opts_chunk$set(comment     = NA,
                      cache       = TRUE,
                      echo        = TRUE, 
                      warning     = FALSE, 
                      message     = FALSE,
                      fig.align   = "center", # center all figures
                      fig.width   = 5,        # set default figure width to 5 inches
                      fig.height  = 3)        # set default figure height to 3 inches

```

## Packages

Make sure the packages are **installed** *(Package tab)*

```{r libraries}
library(magrittr)
library(tidyverse)    # Loads several very helpful 'tidy' packages
library(readxl)       # Read in Excel datasets
library(furniture)    # Nice tables (by our own Tyson Barrett)
library(afex)         # Analysis of Factorial Experiments
library(emmeans)      # Estimated marginal means (Least-squares means)
library(lsmeans)      # Least-Squares Means
library(multcomp)     # Simultaneous Inference in General Parametric Models 
library(pander)       # Formats tables 
```

\clearpage



# SECTION B

## Datasets

```{r data}
audience_wide <- data.frame(id     = 1:12,
                            one    = c(131, 109, 115, 110, 107, 111, 
                                       100, 115, 130, 118, 125, 135),
                            twenty = c(130, 124, 110, 108, 115, 117, 
                                       102, 120, 119, 122, 118, 130),
                            large  = c(135, 126, 108, 122, 111, 121, 
                                       107, 132, 128, 130, 133, 135))

textbook_wide <- data.frame(block = 1:9,
                            A = c(17,  8,  6, 12, 19, 14, 10,  7, 12),
                            B = c(15,  6,  5, 10, 20, 13,  7,  7, 11),
                            C = c(20, 11, 10, 14, 20, 15, 14, 11, 15),
                            D = c(18,  7,  6, 13, 18, 15, 10,  6, 13))

memory_wide <- data.frame(id = 1:6,
                          digit  = c(6, 8, 7, 8, 6, 7),
                          letter = c(5, 7, 7, 5, 4, 6),
                          mixed  = c(6, 5, 4, 8, 7, 5))

tasks_wide <- data.frame(clerical_background   = c(10,  7, 13, 18,  6),
                         clerical_popular      = c(12,  9, 15, 12,  8),
                         clerical_metal        = c( 8,  4,  9,  6,  3),
                         mechanical_background = c(15, 19,  8, 10, 16),
                         mechanical_popular    = c(18, 22, 12, 10, 19),
                         mechanical_metal      = c(20, 23, 15, 14, 19))

anograms_wide <- data.frame(none_5    = c( 9, 10, 12),
                            none_6    = c( 6,  7,  9),
                            none_7    = c( 4,  4,  7),
                            none_8    = c( 2,  3,  5),
                            alone_5   = c(19, 19, 22),
                            alone_6   = c(16, 15, 20),
                            alone_7   = c(15, 11, 17),
                            alone_8   = c(12, 11, 14),
                            withEgo_5 = c(30, 31, 34),
                            withEgo_6 = c(25, 30, 32),
                            withEgo_7 = c(22, 27, 28),
                            withEgo_8 = c(21, 23, 24))

brain_wide <- data.frame(left_digit   = c( 6,  8,  7,  8,  6,  7),
                         left_letter  = c( 5,  7,  7,  5,  4,  6),
                         left_mixed   = c( 6,  5,  4,  8,  7,  5),
                         right_digit  = c( 9,  8,  9,  7,  7,  9),
                         right_letter = c( 8,  8,  7,  8,  6,  8),
                         right_mixed  = c( 6,  7,  8,  8,  7,  9),
                         none_digit   = c( 8, 10,  9,  9,  8, 10),
                         none_letter  = c( 8,  9, 10,  7,  8, 10),
                         none_mixed   = c( 7,  9,  8,  9,  8,  9))
```

\clearpage



## `tasks_wide` - Repeated Measures and Assigned Group Design: Differential Effect of Music on Production, by Task Type

**TEXTBOOK QUESTION:** *In Exercise 15B1, subjects performed a clerical task under three noise conditions. Now suppose a new group of subjects is added to study the effects of the same three conditions on the performance of a simpler, more mechanical task. The data from Exercise 15B1 follow, along with the data for the mechanical task.*

```{r, echo=FALSE}
tasks_wide
```

----------------------------------

```{r, echo=FALSE}
# Restructure from wide to long format:
tasks_long <- tasks_wide %>% 
  tidyr::gather(key = type,
                value = completed) %>% 
  tidyr::separate(type,
                  into = c("type_task", "noise")) %>% 
  dplyr::mutate(id = c(rep(1:5, times = 3), rep(6:10, times = 3))) %>% 
  dplyr::mutate_at(vars(id, type_task, noise), factor) %>% 
  dplyr::select(id, type_task, noise, completed)

head(tasks_long, n= 20)
```

\clearpage



**Summary Statistics**

```{r, echo=FALSE}
# Raw data: summary table
tasks_long %>% 
  dplyr::group_by(type_task, noise) %>%     # divide into groups
  dplyr::summarise(mean = mean(completed),
                   sd   = sd(completed)) %>% 
  dplyr::mutate(msd = paste0(round(mean, 2), " (", round(sd, 2), ")")) %>% 
  dplyr::select(-mean, -sd) %>% 
  tidyr::spread(key = noise,
                value = msd) %>% 
  pander::pander()
```



**Profile Plots (raw data)**

```{r, echo=FALSE}
tasks_long %>% 
  ggplot(aes(x = noise,
             y = completed,
             group = id,
             shape = type_task,
             color = type_task)) +
  geom_point(size = 3) +
  geom_line()
```



**Means Plots (raw data)**

```{r, echo=FALSE}
tasks_long %>% 
  ggplot(aes(x = noise,
             y = completed,
             shape = type_task,
             color = type_task)) +
  stat_summary()
```

\clearpage



### Question B-4a Mixed Design ANOVA: display all Sums-of-Squares components

**TEXTBOOK QUESTION:** *(a) Perform a mixed-design ANOVA, and display the results in a summary table.*

**DIRECTIONS:** Perform a Repeated Measures ANOVA for number of tasks completed under the four noise conditions to see if there is an effect and if the effect is different dependtion on the type of task.  Request no correction for violations of sphericity (`correction = "none"`) and both effect sizes (`es = c("ges", "pes"`).  Make sure to save your model (`fit_tasks`), so that you can add `$aov` at the end of the name to extract all the Sums-of-Squares.

```{r}
# Mixed ANOVA: display all Sums-of-Squares components

```

\clearpage



### Question B-4b Mixed Design ANOVA: effect sizes

**TEXTBOOK QUESTION:** *(b) Calculate generalized eta squared for the main effect of the type-of-task factor. Does this look like a large effect size? Explain.*

**DIRECTIONS:** Run the name of the model `fit_tasks` alone to extract the adjusted degrees of freedom and F-test.  The sums-of-squares for the corrected test are the same as for the uncorrected you just did.

```{r}
# Mixed ANOVA: name the model was saved as

```

------------------

**Means Plot (model based)**

**DIRECTIONS:** Construct a means plot of `fit_audience` using `emmeans::emmip(~ RM_var)` to help interpret the direction of any significant differences.

```{r}
# RM ANOVA: means plot

```

\clearpage



## `anograms_wide` -Repeated Measures and Assigned Group Design: Effect of Music and Task Type on Production

**TEXTBOOK QUESTION:** *Dr. Jones is investigating various conditions that affect mental effort- which, in this experiment, involves solving anagrams. Subjects were randomly assigned to one of three experimental conditions. Subjects in the first group were told that they would not be getting feedback on their performance. Subjects in the second and third groups were told they would get feedback, but only subjects in the third group were told (erroneously) that anagram solving was highly correlated with intelligence and creativity (Dr. Jones hoped this information would produce ego involvement). The list of anagrams given to each subject contained a random mix of problems at four levels of difficulty determined by the number of letters presented (five, six, seven, or eight). The number of anagrams correctly solved by each subject in each condition and at each level of difficulty is given in the following table:*

```{r}
anograms_wide
```

----------------------------------

Restructure from wide to long format:

```{r, echo=FALSE}
anograms_long <- anograms_wide %>% 
  tidyr::gather(key = feedback_difficulty,
                value = correct) %>% 
  tidyr::separate(feedback_difficulty,
                  into = c("feedback", "difficulty")) %>% 
  dplyr::mutate(id = c(rep(1:3, times = 4), 
                       rep(4:6, times = 4), 
                       rep(7:9, times = 4))) %>% 
  dplyr::mutate_at(vars(id, feedback, difficulty), factor) %>% 
  dplyr::select(id, feedback, difficulty, correct)

head(anograms_long, n= 20)
```

\clearpage



**Summary Statistics**

```{r, echo=FALSE}
# Raw data: summary table
anograms_long %>% 
  dplyr::group_by(feedback, difficulty) %>%     # divide into groups
  dplyr::summarise(mean = mean(correct),
                   sd   = sd(correct)) %>% 
  dplyr::mutate(msd = paste0(round(mean, 2), " (", round(sd, 2), ")")) %>% 
  dplyr::select(-mean, -sd) %>% 
  tidyr::spread(key = difficulty,
                value = msd) %>% 
  pander::pander()
```



**Profile Plots (raw data)**

```{r, echo=FALSE}
anograms_long %>% 
  ggplot(aes(x = difficulty,
             y = correct,
             group = id,
             shape = feedback,
             color = feedback)) +
  geom_point(size = 3) +
  geom_line()
```



**Means Plots (raw data)**

```{r, echo=FALSE}
anograms_long %>% 
  ggplot(aes(x = difficulty,
             y = correct,
             shape = feedback,
             color = feedback)) +
  stat_summary()
```

\clearpage



### Question B-5b Mixed Design ANOVA: display all Sums-of-Squares components

**TEXTBOOK QUESTION:** *(b) Perform a mixed analysis of variance, and display the results in a summary table. Would any of your conclusions change if you do not assume sphericity? Explain.*

**DIRECTIONS:** Perform a Repeated Measures ANOVA for number of tasks completed under the four noise conditions to see if there is an effect and if the effect is different dependtion on the type of task.  Make sure to save your model (`fit_ano`), so that you can add `$aov` at the end of the name to extract all the Sums-of-Squares.

```{r}
# Mixed ANOVA: display all Sums-of-Squares components

```

\clearpage



**DIRECTIONS:** Use the `summary()` function on the model name `fit_ano` to display the sphericity test and corrections to answer the last portion of this question.

```{r}
# Mixed ANOVA: sphericity tests and corrections

```

\clearpage



### Question B-5c Mixed Design ANOVA: Main Effect's post-hoc with appropriate correction

**TEXTBOOK QUESTION:** *(c) Perform post hoc pairwise comparisons for both main effects, using the appropriate error term from part b in each case. Explain why these follow-up tests are appropriate given your results in part b.*

**DIRECTIONS:** Use the prior model `fit_ano` to run post hoc test for the levels of each main effect, separately SINCE THE INTERACTION IS NOT SIGNIFICANT (including a means plot).  Choose an appropriate method to control type I errors when making multiple comparisons.

```{r}
# Mixed ANOVA: post hoc pairwise tests <-- feedback

```

--------------------------------

```{r}
# RM ANOVA: means plot <--feedback

```

\clearpage



```{r}
# Mixed ANOVA: post hoc pairwise tests <-- difficulty

```

------------------------

```{r}
# RM ANOVA: means plot <-- difficulty

```

\clearpage



## `brain_wide` - Repeated Measures and Observed Groups Design: Differential Effect of Stimuli on Recall, by Brain Damage

**TEXTBOOK QUESTION:** *Exercise 15B6 described a neuropsychologist studying subjects with brain damage to the left cerebral hemisphere. Such a study would probably include a group of subjects with damage to the right hemisphere and a group of control subjects without brain damage. The data from Exercise 15B6 (the number of digit or letter strings each subject recalled) follow, along with data for the two comparison groups just mentioned.*

```{r}
brain_wide
```

----------------------------------

Restructure from wide to long format:

```{r, echo=FALSE}
brain_long <-  brain_wide %>% 
  tidyr::gather(key = damage_stimuli,
                value = longest_correct) %>% 
  tidyr::separate(damage_stimuli,
                  into = c("damage", "stimuli")) %>% 
  dplyr::mutate(id = c(rep( 1:6,  times = 3), 
                       rep( 7:12, times = 3), 
                       rep(13:18, times = 3))) %>% 
  dplyr::mutate_at(vars(id, damage, stimuli), factor) %>% 
  dplyr::select(id, damage, stimuli, longest_correct)

head(brain_long, n= 20)
```

\clearpage



**Summary Statistics**

```{r, echo=FALSE}
# Raw data: summary table
brain_long %>% 
  dplyr::group_by(damage, stimuli) %>%     # divide into groups
  dplyr::summarise(mean = mean(longest_correct),
                   sd   = sd(longest_correct)) %>% 
  dplyr::mutate(msd = paste0(round(mean, 2), " (", round(sd, 2), ")")) %>% 
  dplyr::select(-mean, -sd) %>% 
  tidyr::spread(key = stimuli,
                value = msd) %>% 
  pander::pander()
```



**Profile Plots (raw data)**

```{r, echo=FALSE}
brain_long %>% 
  ggplot(aes(x = stimuli,
             y = jitter(longest_correct),
             group = id,
             shape = damage,
             color = damage)) +
  geom_point(size = 3) +
  geom_line()
```



**Means Plots (raw data)**

```{r, echo=FALSE}
brain_long %>% 
  ggplot(aes(x = stimuli,
             y = longest_correct,
             shape = damage,
             color = damage)) +
  stat_summary()
```

\clearpage



### Question B-8a-b Mixed Design ANOVA: with sphericity test and corrections

**TEXTBOOK QUESTION:** *(a) Perform a mixed-design ANOVA and test the three F ratios at the .05 level. What can you conclude about the effects of brain damage on short-term recall for these types of stimuli? (b) Draw a graph of these data, subject by subject. Do the assumptions of the mixed-design ANOVA seem reasonable in this case? Explain. *

**DIRECTIONS:** Perform a Repeated Measures ANOVA for longest correct recall under the  various stimuli to see if there is an effect and if the effect is different dependtion on brain damage.  Make sure to save your model (`fit_brain`), so that you can use the  `summary()` function on the name to test for sphericity and make appropriate corrections.

```{r}
# Mixe ANOVA:  with sphericity tests and corrections

```

\clearpage



### Question B-8c Mixed Design ANOVA: Main Effect's post-hoc with appropriate correction

**TEXTBOOK QUESTION:** *(c) Perform post hoc pairwise comparisons for both main effects. Do not assume sphericity for the RM factor.*

**DIRECTIONS:** Use the prior model `fit_brain` to run post hoc test for the levels of each main effect, separately SINCE THE INTERACTION IS NOT SIGNIFICANT (including a means plot).  Choose an appropriate method to control type I errors when making multiple comparisons. (you do not need to worry about sphericity)

```{r}
# Mixed ANOVA: post hoc pairwise tests <-- damage

```

--------------------------------

```{r}
# RM ANOVA: means plot <-- damage

```

\clearpage



```{r}
# Mixed ANOVA: post hoc pairwise tests <-- stimuli

```

--------------------------------

```{r}
# RM ANOVA: means plot <-- stimuli

```

\clearpage



# SECTION C

## Import Data, Define Factors, and Compute New Variables

Import Data, Define Factors, and Compute New Variables

* Make sure the **dataset** is saved in the same *folder* as this file
* Make sure the that *folder* is the **working directory**

> NOTE: I added the second line to convert all the variables names to lower case.  I still kept the `F` as a capital letter at the end of the five factor variables.

```{r ihno}
ihno_clean <- read_excel("Ihno_dataset.xls") %>% 
  dplyr::rename_all(tolower) %>% 
  dplyr::mutate(genderF = factor(gender, 
                                 levels = c(1, 2),
                                 labels = c("Female", 
                                            "Male"))) %>% 
  dplyr::mutate(majorF = factor(major, 
                                levels = c(1, 2, 3, 4,5),
                                labels = c("Psychology",
                                           "Premed",
                                           "Biology",
                                           "Sociology",
                                           "Economics"))) %>% 
  dplyr::mutate(reasonF = factor(reason,
                                 levels = c(1, 2, 3),
                                 labels = c("Program requirement",
                                            "Personal interest",
                                            "Advisor recommendation"))) %>% 
  dplyr::mutate(exp_condF = factor(exp_cond,
                                   levels = c(1, 2, 3, 4),
                                   labels = c("Easy",
                                              "Moderate",
                                              "Difficult",
                                              "Impossible"))) %>% 
  dplyr::mutate(coffeeF = factor(coffee,
                                 levels = c(0, 1),
                                 labels = c("Not a regular coffee drinker",
                                            "Regularly drinks coffee")))  %>% 
  dplyr::mutate(hr_base_bps = hr_base / 60) 
```
 


### Question C-1a Mixed Design ANOVA: with main effect post hocs

**TEXTBOOK QUESTION:** *(a) Perform a mixed-design ANOVA with the three anxiety measures as the RM levels, and major as the between-subjects factor. Request a plot of the cell means, ~~and post hoc tests for both the RM factor (LSD) and for major (Tukey)~~. Report the results of the ANOVA in APA style.*

**DIRECTIONS:** Using the `ihno_anx_long` dataset from the chapter 15 questions, perform a Repeated Measures ANOVA for at the three time points to see if the experiment had an effect on anxiety and if the effect is different dependtion on major.  Make sure to save your model (`fit_anx_major`), so that you can use the `summary()` function on the name to test for sphericity and make appropriate corrections. Do specify that you would like to display BOTH effect size measures with `es = c("ges", "pes")`, but do NOT include `correction = "none"`.

```{r}
# Mixed ANOVA:  with sphericity tests and corrections

```

\clearpage



**DIRECTIONS:** To display the effect size meausre, run the name (`fit_anx_major`) of the model alone.

```{r}
# Mixed ANOVA: effect sizes 

```

---------------------------

**DIRECTIONS:** SINCE THE INTERACTIONIS SIGNIFICANT, instead of focusing on the main effects alone, plot the interaction with the `emmeans::emmip(group_var ~ RM_var)` function.

```{r}
# Mixed ANOVA: means plot <-- interaction

```

\clearpage



## `ihno_clean` - Repeated Measures and Observed Group Design: Differential Effect of a Pop Quiz (Time = Baseline, pre-quiz, post-quiz) on Heart Rate, by Gender

### Question C-2a Mixed Design ANOVA: with main effect post hocs

**TEXTBOOK QUESTION:** *(a) Perform a mixed-design ANOVA with the three heart-rate measures as the RM levels and gender as the between-subjects factor. Request a plot of the cell means and post hoc tests for the RM factor (LSD). Report the results of the ANOVA in APA style.*

```{r}
ihno_clean %>% 
  dplyr::select(sub_num, genderF, hr_base, hr_pre, hr_post) %>% 
  head(n = 4)
```



Restructure from wide to long format:

```{r}
#Restructure: wide-to-long
ihno_hr_long <- ihno_clean %>% 
  tidyr::gather(key = variable,
                value = hr,
                hr_base, hr_pre, hr_post) %>% 
  dplyr::mutate(time = case_when(variable == "hr_base" ~ "baseline",
                                 variable == "hr_pre"  ~ "pre-quiz",
                                 variable == "hr_post" ~ "post-quiz") %>% 
                  factor(levels = c("baseline", "pre-quiz", "post-quiz"))) %>% 
  dplyr::arrange(sub_num, time)
```    



```{r}
ihno_hr_long %>% 
  dplyr::select(sub_num, genderF, time, hr) %>% 
  head(n = 12)
```

\clearpage



**DIRECTIONS:** Using the `ihno_hr_long` dataset just reformatted, perform a Repeated Measures ANOVA for at the three time points to see if the experiment had an effect on heart rateand if the effect is different dependtion on gender  Make sure to save your model (`fit_hr_major`), so that you can use the `summary()` function on the name to test for sphericity and make appropriate corrections. Do specify that you would like to display BOTH effect size measures with `es = c("ges", "pes")`, but do NOT include `correction = "none"`.

```{r}
# Mixe ANOVA:  with sphericity tests and corrections

```

\clearpage



**DIRECTIONS:** Use the prior model `fit_brain` to run post hoc test for the levels of each main effect, separately SINCE THE INTERACTION IS NOT SIGNIFICANT (including a means plot).  Choose an appropriate method to control type I errors when making multiple comparisons. (you do not need to worry about sphericity)

```{r}
# Mixed ANOVA: post hoc pairwise tests <-- damage

```

--------------------------------

```{r}
# RM ANOVA: means plot <-- damage

```

\clearpage



```{r}
# Mixed ANOVA: post hoc pairwise tests <-- genderF

```

--------------------------------

```{r}
# RM ANOVA: means plot <-- stimuli

```

\clearpage



## `ihno_clean` - Repeated Measures and Assigned Group Design: Differential Effect of the Experiemnt (Time = Pop Quiz vs. Standard Quiz) on Quiz Score, by Difficulty Level

### Question C-3a Mixed Design ANOVA: is there an interaction?

**TEXTBOOK QUESTION:** *(a) Perform a mixed-design ANOVA with the two 10-point quizzes (statquiz and exp_sqz) as the RM levels, and exp_cond as the between-subjects factor. Request a plot of the cell means. Report the results of the ANOVA in APA style. If the interaction is significant, explain the pattern you see in the plot of the cell means.*

**DIRECTIONS:** Using the `ihno_statquiz_long` dataset from the chapter 15 questions, perform a Repeated Measures ANOVA for at the two quizes to see if the experiment had an effect on score and if the effect is different dependtion on difficulty level.  Make sure to save your model (`fit_anx_major`), so that you can use the `summary()` function on the name to view the output.  Do specify that you would like to display BOTH effect size measures with `es = c("ges", "pes")`, but do NOT include `correction = "none"`.

> NOTE: When the measure is only repeated twice, sphericity can not be violated, so no such test are performed.

```{r}
# Mixed ANOVA:  with summary

```

\clearpage



**DIRECTIONS:** SINCE THE INTERACTIONIS SIGNIFICANT, instead of focusing on the main effects alone, plot the interaction with the `emmeans::emmip(group_var ~ RM_var)` function.

```{r}
# RM ANOVA: means plot <-- interaction

```


