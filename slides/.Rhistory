dplyr::select(-contains("_ciR"), -contains("_ciL")) %>%
dplyr::mutate(id = factor(id))
names(data_participants)[-1] <- substring(names(data_participants)[-1], 5)
tibble::glimpse(data_participants)
nrow(data_participants)
data_participants %>%
dplyr::filter(gender == "Male",
implant_lingual == "Pre",
implant_lateral == "Bilateral")
data_participants %>%
dplyr::select(-id) %>%
summary()
data_participants %>%
furniture::table1("Gender" = gender,
"Implantation Age (months)" = implant_age_mon,
"Hearing Loss Onset (months)" = hearloss_age_mon,
"Lingual" = implant_lingual,
"Lateral" = implant_lateral,
"Total Appointments" = appts_total,
"Appointments with eSRT" = appts_eSRT_with,
"Appointments without eSRT" = appts_eSRT_lack,
na.rm = FALSE,
total = TRUE)
data_participants %>%
dplyr::mutate(num_ci = ifelse(implant_lateral == "Bilateral", 2, 1)) %>%
dplyr::summarise(sum(num_ci))
data_participants %>%
dplyr::mutate(num_ci = ifelse(implant_lateral == "Bilateral", 2, 1)) %>%
dplyr::filter(appts_eSRT_with > 0) %>%
dplyr::summarise(sum(num_ci))
data_participants %>%
dplyr::group_by(implant_lateral) %>%
dplyr::select(appts_eSRT_with,
appts_eSRT_lack,
appts_total) %>%
dplyr::summarise_all(sum)
```135
data_participants %>%
dplyr::mutate(num_ci = ifelse(implant_lateral == "Bilateral", 2, 1)) %>%
dplyr::summarise(sum(num_ci))
data_participants %>%
dplyr::mutate(num_ci = ifelse(implant_lateral == "Bilateral", 2, 1)) %>%
dplyr::filter(appts_eSRT_with > 0) %>%
dplyr::summarise(sum(num_ci))
data_participants %>%
dplyr::group_by(implant_lateral) %>%
dplyr::select(appts_eSRT_with,
appts_eSRT_lack,
appts_total) %>%
dplyr::summarise_all(sum)
data_ci <- data_clean %>%
dplyr::select(id, contains("_ci"), -contains("v")) %>%
tidyr::pivot_longer(cols = contains("_ci"),
names_to = c(".value", "ci_ear"),
names_pattern = "tin_(.*_.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::filter(!is.na(implant_manufac) | !is.na(always_lack_reason))
data_ci
nrow(data_ci)
data_ci %>%
furniture::table1("Ear with Implant" = ci_ear,
"Manufacturer" = implant_manufac,
na.rm = FALSE,
total = TRUE)
data_ci %>%
furniture::table1(always_lack_reason)
data_appts <- data_clean %>%                  # n = 206
dplyr::select(id, starts_with("v")) %>%
tidyr::pivot_longer(-id,
names_to =c("visit", ".value"),
names_pattern = "v(..)_(.*)") %>%  # n = 206 * 17 = 3502
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
dplyr::select(id, visit, lack_reason, age_mon) %>%
dplyr::select(id, visit,
appt_lack_reason = lack_reason,
appt_age_mon = age_mon)
tibble::glimpse(data_appts)
data_appts_tracking <- data_clean %>%
dplyr::select(id, contains("_ci")) %>%
tidyr::pivot_longer(starts_with("v"),
names_to = c("visit", ".value"),
names_pattern = "v(..)_(.*)") %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
tidyr::pivot_longer(cols = c(contains("ciR"), contains("ciL")),
names_to = c(".value", "ci_ear"),
names_pattern = "(.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, ci_ear,
internal_device = device,
test_side = side) %>%
dplyr::filter(!is.na(internal_device) | !is.na(test_side))
tibble::glimpse(data_appts_tracking)
data_clean %>%
dplyr::select(id, contains("_ci")) %>%
tidyr::pivot_longer(starts_with("v"),
names_to = c("visit", ".value"),
names_pattern = "v(..)_(.*)") %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
tidyr::pivot_longer(cols = c(contains("ciR"), contains("ciL")),
names_to = c(".value", "ci_ear"),
names_pattern = "(.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, ci_ear,
internal_device = device,
test_side = side)
data_clean %>%
dplyr::select(id, contains("_ci")) %>%
tidyr::pivot_longer(starts_with("v"),
names_to = c("visit", ".value"),
names_pattern = "v(..)_(.*)")
data_clean %>%
dplyr::select(id, contains("_ci")) %>%
tidyr::pivot_longer(starts_with("v"),
names_to = c("visit", ".value"),
names_pattern = "v(..)_(.*)") %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
tidyr::pivot_longer(cols = c(contains("ciR"), contains("ciL")),
names_to = c(".value", "ci_ear"),
names_pattern = "(.*)_ci(.)")
tibble::glimpse(data_appts_tracking)
data_clean %>%
dplyr::select(id, contains("_ci")) %>%
tidyr::pivot_longer(starts_with("v"),
names_to = c("visit", ".value"),
names_pattern = "v(..)_(.*)") %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
tidyr::pivot_longer(cols = c(contains("ciR"), contains("ciL")),
names_to = c(".value", "ci_ear"),
names_pattern = "(.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, ci_ear,
internal_device = device,
test_side = side)
data_appts_tracking <- data_clean %>%
dplyr::select(id, contains("_ci")) %>%
tidyr::pivot_longer(starts_with("v"),
names_to = c("visit", ".value"),
names_pattern = "v(..)_(.*)") %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
tidyr::pivot_longer(cols = c(contains("ciR"), contains("ciL")),
names_to = c(".value", "ci_ear"),
names_pattern = "(.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, ci_ear,
internal_device = device,
test_side = side) %>%
dplyr::filter(!is.na(internal_device) | !is.na(test_side)) %>%
dplyr::arrange(id, ci_ear, visit)
tibble::glimpse(data_appts_tracking)
data_appts_tracking
data_appts_tracking <- data_clean %>%
dplyr::select(id, contains("_ci")) %>%
tidyr::pivot_longer(starts_with("v"),
names_to = c("visit", ".value"),
names_pattern = "v(..)_(.*)") %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
tidyr::pivot_longer(cols = c(contains("ciR"), contains("ciL")),
names_to = c(".value", "ci_ear"),
names_pattern = "(.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, ci_ear,
internal_device = device,
test_side = side) %>%
# dplyr::filter(!is.na(internal_device) | !is.na(test_side)) %>%
dplyr::arrange(id, ci_ear, visit)
data_appts_tracking
data_appts_tracking <- data_clean %>%
dplyr::select(id, contains("_ci")) %>%
tidyr::pivot_longer(starts_with("v"),
names_to = c("visit", ".value"),
names_pattern = "v(..)_(.*)") %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
tidyr::pivot_longer(cols = c(contains("ciR"), contains("ciL")),
names_to = c(".value", "ci_ear"),
names_pattern = "(.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, ci_ear,
internal_device = device,
test_side = side) %>%
dplyr::arrange(id, ci_ear, visit)
tibble::glimpse(data_appts_tracking)
data_clean %>%
dplyr::select(id, starts_with("e")) %>%
tidyr::pivot_longer(names_to  = "name",
values_to = "value",
-id)
7004*2*22
data_measures_longlong <- data_clean %>%
dplyr::select(id, starts_with("e")) %>%
tidyr::pivot_longer(names_to  = "name",
values_to = "value",
-id) %>%
dplyr::group_by(id) %>%
dplyr::mutate(visit = 1:17 %>%
rep(each = 4*22)) %>%
dplyr::mutate(measure = c("eSRT",  "MAP") %>%
rep(each = 2*22) %>%
rep(times = 17)) %>%
dplyr::mutate(ci_ear = c("R", "L") %>%
rep(each = 22) %>%
rep(times = 2*17)) %>%
dplyr::mutate(electrode = 1:22 %>%
rep(times = 4*17))  %>%
dplyr::ungroup() %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, measure, ci_ear, electrode, value) %>%
dplyr::filter(!is.na(value)) %>%
tidyr::pivot_wider(names_from = measure,
values_from = value)
tibble::glimpse(data_measures_longlong)
data_measures_longlong <- data_clean %>%
dplyr::select(id, starts_with("e")) %>%
tidyr::pivot_longer(names_to  = "name",
values_to = "value",
-id) %>%
dplyr::group_by(id) %>%
dplyr::mutate(visit = 1:17 %>%
rep(each = 4*22)) %>%
dplyr::mutate(measure = c("eSRT",  "MAP") %>%
rep(each = 2*22) %>%
rep(times = 17)) %>%
dplyr::mutate(ci_ear = c("R", "L") %>%
rep(each = 22) %>%
rep(times = 2*17)) %>%
dplyr::mutate(electrode = 1:22 %>%
rep(times = 4*17))  %>%
dplyr::ungroup() %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, measure, ci_ear, electrode, value) %>%
# dplyr::filter(!is.na(value)) %>%
tidyr::pivot_wider(names_from = measure,
values_from = value)
tibble::glimpse(data_measures_longlong)
data_measures_longlong
206*2*17*22
data_measures_longlong <- data_clean %>%
dplyr::select(id, starts_with("e")) %>%
tidyr::pivot_longer(names_to  = "name",
values_to = "value",
-id) %>%
dplyr::group_by(id) %>%
dplyr::mutate(visit = 1:17 %>%
rep(each = 4*22)) %>%
dplyr::mutate(measure = c("eSRT",  "MAP") %>%
rep(each = 2*22) %>%
rep(times = 17)) %>%
dplyr::mutate(ci_ear = c("R", "L") %>%
rep(each = 22) %>%
rep(times = 2*17)) %>%
dplyr::mutate(electrode = 1:22 %>%
rep(times = 4*17))  %>%
dplyr::ungroup() %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(visit = as.numeric(visit)) %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::select(id, visit, measure, ci_ear, electrode, value) %>%
dplyr::filter(!is.na(value)) %>%
tidyr::pivot_wider(names_from = measure,
values_from = value)
tibble::glimpse(data_measures_longlong)
data_measures_longlong %>%
dplyr::filter(!is.na(eSRT))
data_measures_longlong %>%
dplyr::filter(!is.na(MAP))
data_measures_longlong %>%
dplyr::filter(!is.na(MAP)) %>%
nrow()
data_measures_longlong %>%
dplyr::filter(!is.na(eSRT))%>%
nrow()
data_eSRT_any_long <- data_measures_longlong %>%
dplyr::select(-MAP) %>%
dplyr::group_by(id, visit, ci_ear) %>%
dplyr::summarise(n_electrodes_eSRT = n())  %>%
dplyr::ungroup() %>%
dplyr::group_by(id, ci_ear) %>%
dplyr::mutate(appts_ear_with_eSRT = n_distinct(visit)) %>%
dplyr::ungroup() %>%
dplyr::group_by(id) %>%
dplyr::mutate(appts_par_with_eSRT = n_distinct(visit)) %>%
dplyr::ungroup() %>%
dplyr::select(id, ci_ear, visit,
n_electrodes_eSRT,
appts_ear_with_eSRT,
appts_par_with_eSRT) %>%
dplyr::arrange(id, ci_ear, visit)
tibble::glimpse(data_eSRT_any_long)
206*2*17
data_measures_longlong %>%
nrow()
data_eSRT_any_long <- data_measures_longlong %>%
dplyr::select(-MAP) %>%
dplyr::group_by(id, visit, ci_ear) %>%
dplyr::summarise(n_electrodes_eSRT = n())  %>%
dplyr::ungroup() %>%
dplyr::group_by(id, ci_ear) %>%
dplyr::mutate(appts_ear_with_eSRT = n_distinct(visit)) %>%
dplyr::ungroup() %>%
dplyr::group_by(id) %>%
dplyr::mutate(appts_par_with_eSRT = n_distinct(visit)) %>%
dplyr::ungroup() %>%
dplyr::select(id, ci_ear, visit,
n_electrodes_eSRT,
appts_ear_with_eSRT,
appts_par_with_eSRT) %>%
dplyr::arrange(id, ci_ear, visit)
tibble::glimpse(data_eSRT_any_long)
data_eSRT_any_long
nrow(data_eSRT_any_long)
data_participants
data_participants %>%   # n= 206
dplyr::right_join(data_ci,
by = "id")
data_participants %>%   # nrow = 206
dplyr::right_join(data_ci,
by = "id") %>%    # nrow = 331
dplyr::right_join(data_appts,
by = c("id"))
data_appts
data_participants %>%   # nrow = 206
dplyr::right_join(data_ci,
by = "id") %>%    # nrow = 331
dplyr::left_join(data_appts,
by = c("id"))
data_participants
data_clean %>%
dplyr::select(id, contains("_ci"), -contains("v")) %>%
tidyr::pivot_longer(cols = contains("_ci"),
names_to = c(".value", "ci_ear"),
names_pattern = "tin_(.*_.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::mutate(id = factor(id))
data_ci <- data_clean %>%
dplyr::select(id, contains("_ci"), -contains("v")) %>%
tidyr::pivot_longer(cols = contains("_ci"),
names_to = c(".value", "ci_ear"),
names_pattern = "tin_(.*_.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(ear_has_ci = ifelse(!is.na(implant_manufac) | !is.na(always_lack_reason)),
"Yes",
"No")
data_ci <- data_clean %>%
dplyr::select(id, contains("_ci"), -contains("v")) %>%
tidyr::pivot_longer(cols = contains("_ci"),
names_to = c(".value", "ci_ear"),
names_pattern = "tin_(.*_.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(ear_has_ci = ifelse((!is.na(implant_manufac) | !is.na(always_lack_reason)),
"Yes",
"No")
data_ci
data_ci <- data_clean %>%
dplyr::select(id, contains("_ci"), -contains("v")) %>%
tidyr::pivot_longer(cols = contains("_ci"),
names_to = c(".value", "ci_ear"),
names_pattern = "tin_(.*_.*)_ci(.)") %>%
dplyr::mutate(ci_ear = factor(ci_ear,
levels = c("R", "L"),
labels = c("Right", "Left"))) %>%
dplyr::mutate(id = factor(id)) %>%
dplyr::mutate(ear_has_ci = ifelse((!is.na(implant_manufac) | !is.na(always_lack_reason)),
"Yes",
"No"))
data_ci
nrow(data_ci)
data_ci %>%
dplyr::group_by(ear_has_ci) %>%
nrow()
data_ci %>%
dplyr::group_by(ear_has_ci) %>%
tally()
data_ci %>%
dplyr::filter(ear_has_ci) %>%
furniture::table1("Ear with Implant" = ci_ear,
"Manufacturer" = implant_manufac,
na.rm = FALSE,
total = TRUE)
data_ci %>%
dplyr::filter(ear_has_ci == "Yes") %>%
furniture::table1("Ear with Implant" = ci_ear,
"Manufacturer" = implant_manufac,
na.rm = FALSE,
total = TRUE)
data_ci %>%
dplyr::group_by(ear_has_ci) %>%
furniture::table1("Ear with Implant" = ci_ear,
"Manufacturer" = implant_manufac,
na.rm = FALSE,
total = TRUE)
data_ci %>%
dplyr::filter(ear_has_ci == "Yes") %>%
furniture::table1(always_lack_reason)
data_ci %>%
dplyr::filter(ear_has_ci == "Yes") %>%
furniture::table1(always_lack_reason,
na.rm = FALSWE)
data_ci %>%
dplyr::filter(ear_has_ci == "Yes") %>%
furniture::table1(always_lack_reason,
na.rm = FALSE)
install.packages(tidyr)
install.packages("tidyverse", "tidyr")
install.packages("tidyverse")
install.packages("tidyr")
libaray(tidyrverse)
library(tidyrverse)
library(tidyverse)
install.packages("remotes")
remotes::install_github("TysonStanley/anteo")
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(comment     = NA,
cache       = TRUE,
echo        = TRUE,
warning     = FALSE,
message     = FALSE,
fig.align   = "center",   # center all figures
fig.width   = 6.5,        # set default figure width to 4 inches
fig.height  = 4.5)        # set default figure height to 3 inches
set.seed(843)
library(tidyverse)
df <- tibble::data_frame(
x = rnorm(100),
y = x + rnorm(100)
) %>%
mutate(pred = predict(lm(y ~ x, data = .)))
df %>%
ggplot(aes(x, y)) +
geom_point() +
geom_smooth(method = "lm",
color = "dodgerblue4",
se = FALSE)
df %>%
ggplot(aes(x, y)) +
geom_point() +
geom_smooth(method = "lm",
color = "dodgerblue4",
se = FALSE) +
theme_bw()
df %>%
ggplot(aes(x, y)) +
geom_segment(aes(xend = x, yend = pred, color = y - pred, alpha = abs(y - pred))) +
geom_point() +
geom_smooth(method = "lm",
color = "dodgerblue4",
se = FALSE,
size = 2,
alpha = .8) +
anteo::theme_anteo_wh() +
scale_color_gradient2(low = "chartreuse3",
mid = "grey90",
high = "dodgerblue3") +
labs(color = "Size and\nDirection of\nResidual",
alpha = "Size and\nDirection of\nResidual") +
theme(legend.position = "none")
df %>%
ggplot(aes(x, y)) +
geom_segment(aes(xend = x, yend = pred, color = y - pred, alpha = abs(y - pred))) +
geom_point() +
geom_smooth(method = "lm",
color = "dodgerblue4",
se = FALSE,
size = 2,
alpha = .8) +
theme_bw() +
scale_color_gradient2(low = "chartreuse3",
mid = "grey90",
high = "dodgerblue3") +
labs(color = "Size and\nDirection of\nResidual",
alpha = "Size and\nDirection of\nResidual") +
theme(legend.position = "none")
setwd("~/GitHub/PSY-6600_public/slides")
